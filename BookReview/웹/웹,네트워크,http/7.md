HTTP 특징과 데이터 저장방식
=

### 무상태 프로토콜 : IP, UDP, HTTP

### 상태 프로토콜 : TCP

### 무상태 프로토콜 장점/단점

이전 상태를 어떻게 저장할지 고민하지않아도 된다. 즉 설계가 단순하다.

하지만 로그인을 예시로 들자면 상태를 유지하지않기때문에 사용자가 로그인한 상태를 매번 클라이언트 측에서 추가정보를 주어야한다.

## 쿠키

**브라우저에 있는 작은 저장소 쿠키**는 key-value 값을 가지는 구조로 4KB라는 작은 데이터를 저장할 수 있다.

### 왜 존재하는 걸까?

단순하고 작은 정보이지만 많은 요청이 있을 경우 서버 측에 저장하면 서버측 비용이나 부담이 증가하기에 분리시켰다.

브라우저에 저장하면 속도도 더 빠르다는 장점이 있다.

### 세션쿠키

만료 기간이 없고 브라우저가 종료되면 사라진다.

### 영구 쿠키

만료 기간이 있고 기간이 종료되면 삭제된다.

### HTTP에서 쿠키 사용

서버 측에서 헤더에 쿠키를 지정해 응답하면 브라우저는 해당 쿠키를 저장하고 모든 요청에 쿠키 정보를 담아 전달한다.

## 쿠키의 단점

쿠키는 누구나 볼 수 있어서 보안상 매우 취약하고, 비밀번호같은 경우에 암호화도 되지않은채로 저장되어있다.

누구나 접근하고 탈취하고 위조하는데 매우 쉬운 저장방식이다.

## 웹 스토리지

쿠키와 매우 유사하지만 저장할 수 있는 용량이 5MB ~ 10MB로 크다.

클라이언트에서만 접근이 가능하고 쿠키와 달리 모든 요청에 서버측에 전달하지않는다.

### 로컬 스토리지

의도적으로 삭제하지않는 이상 삭제되지않는다.(장기간 정보에 유리)

### 세션 스토리지

브라우저의 탭이 닫히면 삭제되는 스토리지이다. (일회성 정보에 유리)

## IndexedDB

브라우저에 있는 서버와 비슷한 데이터베이스이다.

쿠키, 스토리지와는 다르게 다양한 형태의 데이터를 저장할 수 있다.

위 두 방식과는 달리 대용량의 데이터를 관리할때 사용한다.

## 세션 저장방식

세션은 서버에서 일시적으로 데이터를 저장할 수 있는 기술이다.

로그인과정을 예시로 보자.

1. 사용자가 로그인한다.

2. 클라이언트는 회원 정보를 서버에 전달한다.

3. 서버는 이전 접근을 확인하고 처음이라면 세션ID를 발급하고 서버 측 메모리에 저장한다.

4. 서버는 응답에 세션ID를 전달한다.

5. 클라이언트는 세션ID를 **쿠키**에 저장한다.

즉 세션 저장 방식은 쿠키와 다른것이아니라 **쿠키에 기반한 방식**이라 볼 수 있다.

## 세션 하이잭킹

중간에 의문이 들었다.

세션ID 자체에는 의미없는 값이기때문에 탈취하더라도 의미있는 정보를 알아낼 수 없다.(비밀번호)

하지만 해커가 해당 브라우저의 요청메세지를 하이잭킹한다면 어떻게 될까?

HTTPS로 해결이 가능하다.

요청 메세지를 가로챈다고해서 마치 자신이 브라우저인것 마냥 요청메세지를 보낼 수 없다.

HTTPS로 암호화된 메세지는 오직 서버의 개인키로만 해독이 가능하기때문이다.

세션 하이잭킹이 아니더라도 서버측에서 세션ID를 매번생성하고 관리하는 부담이 있기때문에 이 방식의 단점으로 꼽힌다.

서버를 수평적으로 확장한다면 모든 서버가 같은 데이터를 공유해야하기때문에 이 또한 부담이 크다.

중앙 관리 서버를 별도로 필요로하기도한다.

## JWT

JWT이라는 토큰 방식은 세션과 달리 브라우저 측에서 관리하는 정보다.

로그인한 회원의 토큰을 서버가 발행하고 이 토큰을 서버에 저장하지않고 브라우저에 저장한다.(스토리지나 쿠키)

이 후에 로그인 요청이 오면 서버는 토큰이 유효한지만 검사후 들여보낸다.(토큰의 핵심은 데이터 위변조)

하지만 JWT도 탈취의 위험이 여전하다. 그렇기때문에 JWT에 민감한 비밀번호같은 정보는 넣지 않아야한다.

Access 토큰의 유효기간을 짧게하더라도 탈취당하면 대응할 방법이 없다.

그래서 httpOnly 쿠키에만 저장해 HTTP요청에만 사용할 수 있도록 만들 수 있다. https방식이라면 요청메세지를 가로채기 어렵다.

하지만 모바일은 기본적으로 쿠키가 없기때문에 이 방식을 사용할 수 없다.

그래서 NoSQL 데이터베이스에 따로 Access token과 Refresh token을 저장해 비교하는 방식을 선택할 수 있다.

결국 돌고 돌아 세션과같이 별도의 DB를 두게된다.