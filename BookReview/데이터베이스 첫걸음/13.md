8장 테이블 설계 기초
=

## 1. 테이블은 공통적인 요소의 집합이다.

테이블의 열은 행의 특성들을 나열하고 복수의 행들은 같은 특성을 가진 집합이다.

## 2. 테블명은 반드시 복수형이나 집합명사로 표현해야한다

## 3. 사물과 사물의 집합은 계층이다르다.

완두콩 오이 배추 토마토 는 하나의 개체 즉 사물이고 이 사물들의 집합이 테이블로 정의된다.

즉 개별적인 개체들과 개체들의 집합은 당연하게도 계층이 다르다.

## 4. 테이블에서는 반드시 기본키를 설정할 것

현실 세계에도 같은 사람은 존재하지않듯이 테이블에서도 현실세계와 마찬가지다.

같은 행은 존재할 수 없다. 이름과 나이 성별이 같은 두 사람이 있더라도 그 둘은 완전히 다른 두 사람이다.

이렇게 두 개체(두 개의 행)을 다르도록 규정할 수 있는 NULL을 허용하지않는 Unique한 값 Primary Key를 설정해야한다.

또한 기본키는 절대로 바뀌어서는 안된다. 단기적으로 변경되지않는 키가아닌 장기적으로도 변경되어서는 안된다.

예를 들어 이름을 기본키로한다면 동성동명도 문제가 되겠지만 또 다른 문제는 개명한 경우 기본키가 변경되어야한다는 점이다.

---

## 정규형

테이블을 한 마디로 정의한다면 고유한 기본키를 가진 공통점에 의해 정리된 집합 이라 할 수 있다.

이 테이블을 잘 설계하기위한 하나의 규칙이 정규형이다.

## 제 1 정규형

제 1 정규형은 일부러 만족시키지 않으려고 하지않는 이상 지켜지기 매우 쉽다.

하나의 셸은 복수의 값을 가질 수 없다 라는 규칙이다.

간단한 예시로 한 학생의 취미가 테니스,수영,게임 이라는 3가지 복수의 값을 갖는다면 제 1 정규형을 어기게된다.

더 이상 나눌 수 없는 값을 스칼라값이라 하는데 제 1정규형은 모든 값이 스칼라값이여야한다.

### 테이블은 함수다

다음부터 나올 2,3정규형은 **테이블이 집합과 함수**라는 이해를 필요로한다.

기본기가 A이고 나머지 열이 B, C, D인 하나의 행을 생각해보자.

A라는 기본키를 입력으로하고 출력은 B, C, D로 볼 수 있다.

이렇게 기본키열로 일반키열을 출력할 수 있는 것을보고 테이블은 함수라는 개념이 도출됐다.

또 매우 중요한 한 가지 개념은 기본키와 다른 열 사이에 성립하는 함수적인 유일성을 **함수 종속성**이라한다.

위에서 언급한 학생의 취미에대한 예시를 다시 가져오자.

학생이라는 테이블에는 기본키로 학생ID 일반 열은 취미, 이름, 나이, 성별 이 있다고 해보자.

테이블이 함수라는 것은 학생ID로 일반 열을 조회할 수 있다는 의미였다.

함수종속(함수적 유일성)은 학생ID(기본키)로 유일하게 식별이 가능해야한다는 것이다.

학생ID로 이름 나이 성별은 유일하게 식별되지만 취미는 유일하게 식별되지않음으로 함수종속을 만족시키지않는다.

앞으로의 2,3정규형은 이러한 함수종속을 해결해나가는 과정이다.

## 제 2 정규형

**먼저 기억해야할 점은 기본키가 1개의 열이라면 제2정규형은 자동으로 만족하게된다**

그렇다면 문제가 되는 상황은 기본키가 1개가 아닌 복수로 존재할 때이다.

A B C D E 라는 열을 가진 제 2 정규형을 만족시키지못하는 테이블을 가정해보자.

A와B는 복합키이면서 기본키이다.

A와B가 함께 복합키여야만 식별할 수 있는 값은 C이고 D와E는 굳이 A와B가 복합키가아니더라도 A라는 기본키로도 식별이 된다는 상황이다.

이러한 상황을 부분함수 종속 관계라 한다.

기본키열중에 일부 기본키로만으로도 함수종속이 성립하게되면 나머지 기본키는 위 관계에서는 쓸모가 없어진다.

이런 부분함수종속을 제거하는 것이 제 2 정규형을 만족시켜나가는 과정이다.

A D E 라는 테이블을 따로 분리하면 A만으로 D E 를 식별할 수 있고 A와 B가 함께 복합키로 식별해야하는 C로 분리한다.

![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99254B345BD9A22E11)

다음 왼쪽 테이블은 제 2 정규형을 만족시키지 못한다.

**종업원이라는 기본키만으로도 근무지는 충분히 식별된다.**

위 오른쪽 두 테이블이 제 2 정규형을 만족시킨 테이블이다.

### 그렇다면 왜 ! 제 2 정규형을 만족시켜야할까. 무슨 문제가 생기는 걸까?

다시 말하지만 종업원과 근무지는 부분함수종속관계에 있다.

종업원 Jones의 근무지를 93 Main Street로 수정해야하는데 위 두행은 수정했지만 실수로 3번째 행은 수정하지 못 했다고 생각해보자.

Jones의 근무지를 특정할 수 있는가? 이러한 문제점을 갱신 이상이라고한다.

바로 이같은 문제점으로인해 제 2정규형을 만족시킨 테이블로 분리해야한다.

### 정리: 제2정규형은 부분함수종속관계에서 완전함수종속관계로 테이블을 분리해내는 규칙이다.

### 명심할 점 : 기본키가 1개라면 제2정규형은 자동으로 만족되고 복합키 중 하나의 기본키로만 식별되는 열이 존재한다면 부분함수종속으로 보고 제2정규형을 만족시키도록 테이블을 분리해야한다.

## 제 3 정규형

제 3 정규형은 이행적함수종속을 해소하는 규칙이다.

이행적 함수 종속은 도대체 뭘까?

![img](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F9974AB4E5BD9AB0A1E)

사실 위 테이블을 보자마자 이상하다는 생각이 든다면 아주아주아주 좋다.

학생테이블에 학과전화번호가 있어야할 이유가 있을까?

학생을 객체라고 생각한다면 학생 객체에 학과전화번호라는 인스턴스변수를 가져야할 이유는 없다.

테이블 역시 마찬가지다.

하지만 이렇게 쉽게 식별되는 경우도 있지만 쉽지않은 경우도 있으니 이행적 함수 종속 관계를 살펴보자.

학번이라는 기본키로 학과를 특정할 수 있다. 완전함수종속관계다. (기본키가 한 개이기때문에 자동으로 제 2정규형 만족)

또한 학과명으로 학과전화번호를 특정할 수 있다.

**A -> B -> C 인 관계가 성립한다**

이런 이행적 관계를 해소시켜야하는 이유는 뭘까?

### 첫 번째 이유 : 갱신이상

새 학기가되어서 컴퓨터공학과 학생을 대량으로 등록해야한다. 그만큼 학과전화번호도 의미없이 (중복을 발생시키며) 증가한다.

그런데 만약 학과 전화번호가 변경되었다면 모든 행을 예외없이 갱신해야한다. 하나라도 빠진다면 유일하게 특정이 불가능하다. 

**즉 갱신이상이 발생한다**

### 두 번째 이유 : 삭제이상

위 왼쪽 테이블과같이 멀티미디어학과 학생이 극단적으로 단 한명이라 가정해보자.

저 학생이 테이블에서 지워진다면 학과와 학과에 대응되는 번호도 같이 사라지며 데이터베이스 어디에서도 볼 수가 없다.

### 세 번째 이유 : 삽입이상

새 학기에 아직 학생은 없지만 학과를 새롭게 만드려한다. 하지만 왼쪽 테이블은 학생ID가 기본키이기때문에 새로운 학과를 등록할 수 없다. (기본키로 NULL불가)
하지만 제 3 정규형을 만족시킨 테이블로 분리한다면 가능하다.

### 또 한 가지 중요한 점

위에서 테이블을 분리한다면 학생 테이블에서 학과컬럼은 FK (외래키)가 된다는 점이다. 외래키라는 것은 학과테이블에 없는 학과는 학생테이블에 없어야한다는 규약이다.

이를 외래키 제약이라고도 부른다.













